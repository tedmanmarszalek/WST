<!DOCTYPE html>
<html>
<head>
  <style>
    html, body {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
    }
    #map {
      width: 100%;
      height: 50%;
      margin: 0 auto;
      position: fixed;
      top: 0;
    }
  </style>
  <title>UPD</title>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
  <link href='https://fonts.googleapis.com/css?family=Oxygen:400,700,300' rel='stylesheet' type='text/css'>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.2.10/angular-ui-router.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.10/angular.min.js"></script>
  <script src="https://rawgit.com/angular-ui/angular-google-maps/2.3.2/dist/angular-google-maps.min.js"></script>
  <script>

    var app = angular.module('list_sculptures', []);

    app.factory('sculptureListFactory', function($http){
      var getData = function(){
        return $http.get("/sculpture").then(function(result){
          return result.data;
        });  
      }

      return { getData: getData };
    });

    app.controller('SculptureListCtrl', function ($scope, sculptureListFactory) {
      
      $scope.sculpture = null;
      $scope.addImage = false;
      $scope.name = sessionStorage.getItem('name');
      $scope.number = sessionStorage.getItem('number');
      var sculpturePromise = sculptureListFactory.getData();

      sculpturePromise.then(function(result) {
        console.log("promise completed");
        var data = result;

        for(var i = 0; i < data.length; i++){
          if(" " + data[i].sculpture_name == $scope.name)
          {
            console.log("pushing" + data[i].sculpture_name + "to sculpture");
            $scope.sculpture = data[i];
          }
        }
      });
    });
    function initMap() {
      var mapDiv = document.getElementById('map');
      var map = new google.maps.Map(mapDiv, {
        center: {lat: 40.079874, lng: -88.204610},
        zoom: 17,
        mapTypeControl: false,
        streetViewControl: false
      });  
      var xmlHttp = new XMLHttpRequest();
      xmlHttp.onreadystatechange = function() {
        if(xmlHttp.readyState == 4 && xmlHttp.status == 200) 
        {
          var myArr = JSON.parse(xmlHttp.responseText);
          addMarkers(myArr);
        }
      };
      xmlHttp.open("GET", "/sculpture", true);
      xmlHttp.send();
      function addMarkers(arr){
        for(i = 0; i < arr.length; i++) {
          if(arr[i].active && (" "+arr[i].sculpture_name) == sessionStorage.getItem('name')){
            var marker = new google.maps.Marker({
              position: new google.maps.LatLng(arr[i].coordinates_latitude, arr[i].coordinates_longitude),
              icon: '/img/Icons/Circles/BlueSmall/' + sessionStorage.getItem('number') + "BlueSmall.png",
              draggable: false,
              map: map
            });
          }
        }
      } 
    }
  </script>
</head>
<body ng-app="list_sculptures" ng-controller="SculptureListCtrl" style="overflow-x:hidden">
  <div id="map"></div>
  <img style="position:absolute; width:100px; height:100px; top:30px; right:30px" src="/img/Icons/Notifications.png"></img>
  <img style="position:absolute; width:100px; height:100px; top:30px; left:30px" src="/img/Icons/GoBackToList.png" onclick="document.location = 'overview.html';"></img>
  <script src="https://maps.googleapis.com/maps/api/js?callback=initMap"
      async defer></script>
  <div class="container" style="height:225px; width:100%;">
    <table class = "table" border="0" cellpadding="0" cellspacing="0" style="width:100%;">
      <thead>
        <tr>
          <th class="col-md-1 col-xs-1"></th>
          <th class="col-md-8 col-xs-7"></th>
          <th class="col-md-0 col-xs-0"></th>
        </tr>
      <thead>

      <tbody>
          <tr>
            <td style="padding-top:12px; align:center; vertical-align:middle;"><img src="/img/Icons/Circles/BlueBig/{{ number }}BlueBig.png" alt="" height=80 width=80></img></td>
            <td id="{{sculpture.number}}" style="padding-top:67px; padding-left:40px;" align="left"> <FONT COLOR=BLACK FACE="Geneva, Arial" SIZE=7>{{sculpture.sculpture_name}}</FONT></td>
            <td style="padding-top:0px; padding-bottom:0px;" align="right"><img src="{{ sculpture.image }}" alt="" height=200 width=200></img> </td>
          </tr>                    
        </tbody> 
    </table>
  </div>
  <div style="padding-left: 30px; padding-right:30px;"><p align="center"><FONT COLOR=BLACK FACE="Geneva, Arial" SIZE=6>By {{sculpture.artist}}</FONT></p></div>
  <div style="padding-left: 30px; padding-right:30px;"><p align="center"><FONT COLOR=BLACK FACE="Geneva, Arial" SIZE=3>Message from the artist(s)</FONT></p></div>
  <div style="padding-left: 30px; padding-right:30px;"><p align="left"><FONT COLOR=BLACK FACE="Geneva, Arial" SIZE=2>{{sculpture.artist_statement}}</FONT></p></div>
  <div style="padding: 30px;"><img src="/img/Icons/WatchVideo.png"></div>
  <div style="padding: 30px;"><img src="/img/Icons/PlayAudio.png"><FONT COLOR=BLACK FACE="Geneva, Arial" SIZE=5>&nbsp&nbspSound Tour: Story Behind {{sculpture.sculpture_name}}</FONT></div>
</body>
</html>